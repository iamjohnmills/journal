<html>

<head>
 <title>John Mills</title>
 <meta charset="utf-8">
 <meta name="viewport" content="width=device-width">
 <link rel="stylesheet" href="https://iamjohnmills.github.io/journal/assets/site.css" />
 <script src="https://iamjohnmills.github.io/journal/assets/site.js"></script>
</head>

<body>
 <header>
  <div data-toggle-nav="true">
   <svg width="16" height="16" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path fill="#33363F" d="m4 10-.707.707L2.586 10l.707-.707L4 10Zm17 8a1 1 0 1 1-2 0h2ZM8.293 15.707l-5-5 1.414-1.414 5 5-1.414 1.414Zm-5-6.414 5-5 1.414 1.414-5 5-1.414-1.414ZM4 9h10v2H4V9Zm17 7v2h-2v-2h2Zm-7-7a7 7 0 0 1 7 7h-2a5 5 0 0 0-5-5V9Z" />
   </svg> More Articles
  </div>
  <a class="button" href="https://iamjohnmills.github.io/journal/johnmills.rss">
   <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 100 100" xml:space="preserve">
    <path d="M26.258 64.949a8.78 8.78 0 0 0-8.78 8.784 8.782 8.782 0 1 0 17.564 0 8.78 8.78 0 0 0-8.784-8.784z" />
    <path d="M23.536 40.801c-.046 0-.09.006-.135.007v-.007h-3.464v.039a3.437 3.437 0 0 0-3.056 3.344h-.007v6.159h.041a3.43 3.43 0 0 0 3.021 3.002v.039H23.4v-.048c.045.001.09.007.135.007 12.772 0 23.173 10.321 23.311 23.061h-.033v3.464h.039a3.437 3.437 0 0 0 3.344 3.056v.007h6.158v-.041a3.43 3.43 0 0 0 3.002-3.021h.039v-3.464h-.006c-.137-19.657-16.166-35.604-35.853-35.604z" />
    <path d="M83.119 76.403C82.98 43.664 56.308 17.07 23.536 17.07c-.046 0-.09.006-.135.007v-.007h-3.464v.039a3.437 3.437 0 0 0-3.056 3.344h-.007v6.159h.041a3.429 3.429 0 0 0 3.021 3.002v.039H23.4v-.048c.045.001.09.007.135.007 25.857 0 46.902 20.967 47.041 46.792h-.035v3.464h.039a3.437 3.437 0 0 0 3.344 3.056v.007h6.159v-.041a3.43 3.43 0 0 0 3.002-3.021h.039v-3.464h-.005z" />
   </svg> RSS </a>
 </header>
 <main>
  <nav>
   <span>I mostly post minimal experiments, tips, and tricks. Keep up-to-date with me and subscribe to my <a href="https://iamjohnmills.github.io/journal/johnmills.rss" target="_blank">RSS Feed</a></span>
   <a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;d3-orthographic-image&#x2F;">Orthographic Image Projection with D3</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;animated-nav-icon&#x2F;">Animated Nav Menu</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;vector-earth&#x2F;">Vector Earth 3D</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;giftv&#x2F;">GifTV</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;shaders&#x2F;">WebGL shaders</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;n64&#x2F;">Spinning N64 logo</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;chat-bubbles&#x2F;">Chat bubbles</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;canvas-video&#x2F;">Video to canvas</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;90s-shapes&#x2F;">90s abstract shapes</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;equalizer&#x2F;">Animated equalizer</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;synthwave-highway&#x2F;">Synthwave highway</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;plasma&#x2F;">Plasma</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;matrix&#x2F;">Matrix</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;cursor-follow&#x2F;">Follow mouse cursor</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;game-of-life&#x2F;">Game of life</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;create-node&#x2F;">My one-function JS framework</a>
  </nav>
  <section>
   <p>Mar 2023</p>
   <h1>Video to canvas</h1>
   <p>Here I explore drawing frames of video to canvas, which exposes more possibilities of manipulating the pixel data to apply cool effects on.</p>
   <pre data-code="%3Chtml%3E%0A%20%20%3Chead%3E%0A%20%20%20%20%3Cmeta%20name%3D%22viewport%22%20content%3D%22width%3Ddevice-width%2C%20initial-scale%3D1.0%2C%20maximum-scale%3D1.0%2C%20user-scalable%3Dno%22%3E%0A%20%20%20%20%3Cmeta%20charset%3D%22utf-8%22%3E%0A%20%20%20%20%3Cstyle%3E%0A%20%20%20%20%20%20*%20%7B%20box-sizing%3A%20border-box%3B%20%7D%0A%20%20%20%20%20%20html%2C%20body%20%7B%20height%3A%20100%25%3B%20margin%3A%200%3B%20overflow%3A%20hidden%3B%20font-family%3A%20system-ui%3B%20%7D%0A%20%20%20%20%20%20%23root%20%7B%20width%3A%20100%25%3B%20height%3A%20100%25%3B%20overflow%3A%20hidden%3B%20position%3A%20relative%3B%20display%3A%20flex%3B%20align-items%3A%20center%3B%20justify-content%3A%20center%3B%20%7D%0A%20%20%20%20%20%20canvas%20%7B%20position%3A%20absolute%3B%20left%3A%200%3B%20top%3A%200%3B%20background%3A%20%23000%3B%20width%3A%20100%25%3B%20height%3A%20100%25%3B%20object-fit%3A%20contain%3B%20%7D%0A%20%20%20%20%20%20.start%20%7B%20cursor%3A%20pointer%3B%20position%3A%20absolute%3B%20top%3A%200%3B%20right%3A%200%3B%20bottom%3A%200%3B%20left%3A%200%3B%20background%3A%20%23000%3B%20display%3A%20flex%3B%20align-items%3A%20center%3B%20justify-content%3A%20center%3B%20color%3A%20%23fff%3B%20font-weight%3A%20bold%3B%20%7D%0A%20%20%20%20%20%20.action%20%7B%20position%3A%20absolute%3B%20left%3A%2030px%3B%20bottom%3A%2030px%3B%20z-index%3A%201%3B%20user-select%3A%20none%3B%20%7D%0A%20%20%20%20%3C%2Fstyle%3E%0A%20%20%20%20%3Cscript%3E%0A%20%20%20%20%20%20const%20createNode%20%3D%20(options)%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20const%20node%20%3D%20document.createElement(options.tag)%3B%0A%20%20%20%20%20%20%20%20if(options.className)%20node.setAttribute('class'%2Coptions.className)%3B%0A%20%20%20%20%20%20%20%20if(options.innerHTML)%20node.innerHTML%20%3D%20options.innerHTML%3B%0A%20%20%20%20%20%20%20%20if(options.attributes)%20Object.keys(options.attributes).forEach(key%20%3D%3E%20node.setAttribute(key%2Coptions.attributes%5Bkey%5D)%20)%3B%0A%20%20%20%20%20%20%20%20if(options.style)%20Object.keys(options.style).forEach(key%20%3D%3E%20node.style%5Bkey%5D%20%3D%20options.style%5Bkey%5D)%3B%0A%20%20%20%20%20%20%20%20if(options.event_listeners)%20Object.keys(options.event_listeners).forEach(key%20%3D%3E%20node.addEventListener(key%2Coptions.event_listeners%5Bkey%5D)%20)%0A%20%20%20%20%20%20%20%20if(options.root)%20options.root.appendChild(node)%3B%0A%20%20%20%20%20%20%20%20return%20node%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20class%20App%20%7B%0A%20%20%20%20%20%20%20%20constructor()%7B%0A%20%20%20%20%20%20%20%20%20%20document.addEventListener('DOMContentLoaded'%2Cthis.handleReady.bind(this))%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20handleReady()%7B%0A%20%20%20%20%20%20%20%20%20%20if(this.interval)%20cancelAnimationFrame(this.interval)%3B%0A%20%20%20%20%20%20%20%20%20%20this.els%20%3D%20%7B%7D%3B%0A%20%20%20%20%20%20%20%20%20%20this.video_playing%20%3D%20false%3B%0A%20%20%20%20%20%20%20%20%20%20this.ready%20%3D%20false%3B%0A%20%20%20%20%20%20%20%20%20%20this.effect_on%20%3D%20false%3B%0A%20%20%20%20%20%20%20%20%20%20this.els.root%20%3D%20document.getElementById('root')%3B%0A%20%20%20%20%20%20%20%20%20%20this.els.root.innerHTML%20%3D%20%60%60%3B%0A%20%20%20%20%20%20%20%20%20%20this.video%20%3D%20createNode(%7B%20tag%3A%20'video'%2C%20attributes%3A%20%7B%20src%3A%20%60geisha.mp4%60%2C%20loop%3A%20'true'%2C%20playsinline%3A%20'true'%20%7D%20%7D)%0A%20%20%20%20%20%20%20%20%20%20this.els.canvas%20%3D%20createNode(%7B%20root%3A%20this.els.root%2C%20tag%3A%20'canvas'%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20this.els.canvas.addEventListener('click'%2C%20event%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if(this.video_playing)%20this.video.pause()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20else%20this.video.play()%3B%0A%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20this.context%20%3D%20this.els.canvas.getContext('2d')%3B%0A%20%20%20%20%20%20%20%20%20%20this.els.start%20%3D%20createNode(%7B%20root%3A%20this.els.root%2C%20tag%3A%20'div'%2C%20className%3A%20'start'%20%7D)%0A%20%20%20%20%20%20%20%20%20%20this.els.start_button%20%3D%20createNode(%7B%20root%3A%20this.els.start%2C%20tag%3A%20'button'%2C%20innerHTML%3A%20'Click%20to%20load%20video'%20%7D)%0A%20%20%20%20%20%20%20%20%20%20this.els.start_button.addEventListener('click'%2Cthis.handleClickStart.bind(this))%3B%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20this.els.start.addEventListener('touchstart'%2Cthis.handleClickStart.bind(this))%3B%0A%20%20%20%20%20%20%20%20%20%20this.video.addEventListener('loadedmetadata'%2C%20async%20event%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20this.els.canvas.width%20%3D%20this.video.videoWidth%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this.els.canvas.height%20%3D%20this.video.videoHeight%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this.els.action%20%3D%20await%20createNode(%7B%20root%3A%20this.els.root%2C%20tag%3A%20'button'%2C%20className%3A%20'action'%2C%20innerHTML%3A%20'Toggle%20effect'%2C%20style%3A%20%7B%20display%3A%20%60none%60%20%7D%20%7D)%0A%20%20%20%20%20%20%20%20%20%20%20%20this.els.action.addEventListener('click'%2C%20event%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.effect_on%20%3D%20!this.effect_on%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this.interval%20%3D%20window.requestAnimationFrame(this.render.bind(this))%3B%0A%20%20%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20async%20handleClickStart(event)%7B%0A%20%20%20%20%20%20%20%20%20%20await%20this.video.play()%3B%0A%20%20%20%20%20%20%20%20%20%20this.els.start.style.display%20%3D%20%60none%60%3B%0A%20%20%20%20%20%20%20%20%20%20this.els.action.style.display%20%3D%20%60block%60%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20rgbSplit(imageData%2C%20options)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20https%3A%2F%2Fhangindev.com%2Fblog%2Frgb-splitting-effect-with-html5-canvas-and-javascript%0A%20%20%20%20%20%20%20%20%20%20const%20%7B%20rOffset%20%3D%200%2C%20gOffset%20%3D%200%2C%20bOffset%20%3D%200%20%7D%20%3D%20options%3B%0A%20%20%20%20%20%20%20%20%20%20const%20originalArray%20%3D%20imageData.data%3B%0A%20%20%20%20%20%20%20%20%20%20const%20newPixels%20%3D%20new%20Uint8ClampedArray(originalArray)%3B%0A%20%20%20%20%20%20%20%20%20%20for%20(let%20i%20%3D%200%3B%20i%20%3C%20originalArray.length%3B%20i%20%2B%3D%204)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20newPixels%5Bi%20%2B%200%20%2B%20rOffset%20*%204%5D%20%3D%20originalArray%5Bi%20%2B%200%5D%3B%20%2F%2F%20%F0%9F%94%B4%0A%20%20%20%20%20%20%20%20%20%20%20%20newPixels%5Bi%20%2B%201%20%2B%20gOffset%20*%204%5D%20%3D%20originalArray%5Bi%20%2B%201%5D%3B%20%2F%2F%20%F0%9F%9F%A2%0A%20%20%20%20%20%20%20%20%20%20%20%20newPixels%5Bi%20%2B%202%20%2B%20bOffset%20*%204%5D%20%3D%20originalArray%5Bi%20%2B%202%5D%3B%20%2F%2F%20%F0%9F%94%B5%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20return%20new%20ImageData(newPixels%2C%20imageData.width%2C%20imageData.height)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20drawVideo()%7B%0A%20%20%20%20%20%20%20%20%20%20this.context.drawImage(this.video%2C%200%2C%200%2C%20this.video.videoWidth%2C%20this.video.videoHeight)%3B%0A%20%20%20%20%20%20%20%20%20%20if(this.effect_on)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20imageData%20%3D%20this.context.getImageData(0%2C%200%2C%20this.video.videoWidth%2C%20this.video.videoHeight)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20updatedImageData%20%3D%20this.rgbSplit(imageData%2C%20%7B%20rOffset%3A%2020%2C%20gOffset%3A%20-10%2C%20bOffset%3A%2010%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this.context.putImageData(updatedImageData%2C%200%2C%200)%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20render()%7B%0A%20%20%20%20%20%20%20%20%20%20this.video_playing%20%3D%20!!(this.video%20%26%26%20this.video.currentTime%20%3E%200%20%26%26%20!this.video.paused%20%26%26%20!this.video.ended%20%26%26%20this.video.readyState%20%3E%202)%3B%0A%20%20%20%20%20%20%20%20%20%20if(this.video_playing)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20this.drawVideo()%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20this.interval%20%3D%20window.requestAnimationFrame(this.render.bind(this))%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20const%20app%20%3D%20new%20App()%3B%0A%20%20%20%20%3C%2Fscript%3E%0A%20%20%3C%2Fhead%3E%0A%20%20%3Cbody%3E%0A%20%20%20%20%3Cdiv%20id%3D%22root%22%3E%3C%2Fdiv%3E%0A%20%20%3C%2Fbody%3E%0A%3C%2Fhtml%3E%0A"><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css">
      * { <span class="hljs-attribute">box-sizing</span>: border-box; }
      <span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>; <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">overflow</span>: hidden; <span class="hljs-attribute">font-family</span>: system-ui; }
      <span class="hljs-selector-id">#root</span> { <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>; <span class="hljs-attribute">overflow</span>: hidden; <span class="hljs-attribute">position</span>: relative; <span class="hljs-attribute">display</span>: flex; <span class="hljs-attribute">align-items</span>: center; <span class="hljs-attribute">justify-content</span>: center; }
      <span class="hljs-selector-tag">canvas</span> { <span class="hljs-attribute">position</span>: absolute; <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">background</span>: <span class="hljs-number">#000</span>; <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>; <span class="hljs-attribute">object-fit</span>: contain; }
      <span class="hljs-selector-class">.start</span> { <span class="hljs-attribute">cursor</span>: pointer; <span class="hljs-attribute">position</span>: absolute; <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">background</span>: <span class="hljs-number">#000</span>; <span class="hljs-attribute">display</span>: flex; <span class="hljs-attribute">align-items</span>: center; <span class="hljs-attribute">justify-content</span>: center; <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>; <span class="hljs-attribute">font-weight</span>: bold; }
      <span class="hljs-selector-class">.action</span> { <span class="hljs-attribute">position</span>: absolute; <span class="hljs-attribute">left</span>: <span class="hljs-number">30px</span>; <span class="hljs-attribute">bottom</span>: <span class="hljs-number">30px</span>; <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>; user-select: none; }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript">
      <span class="hljs-keyword">const</span> <span class="hljs-title function_">createNode</span> = (<span class="hljs-params">options</span>) =&gt; {
        <span class="hljs-keyword">const</span> node = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(options.<span class="hljs-property">tag</span>);
        <span class="hljs-keyword">if</span>(options.<span class="hljs-property">className</span>) node.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;class&#x27;</span>,options.<span class="hljs-property">className</span>);
        <span class="hljs-keyword">if</span>(options.<span class="hljs-property">innerHTML</span>) node.<span class="hljs-property">innerHTML</span> = options.<span class="hljs-property">innerHTML</span>;
        <span class="hljs-keyword">if</span>(options.<span class="hljs-property">attributes</span>) <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(options.<span class="hljs-property">attributes</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> node.<span class="hljs-title function_">setAttribute</span>(key,options.<span class="hljs-property">attributes</span>[key]) );
        <span class="hljs-keyword">if</span>(options.<span class="hljs-property">style</span>) <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(options.<span class="hljs-property">style</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> node.<span class="hljs-property">style</span>[key] = options.<span class="hljs-property">style</span>[key]);
        <span class="hljs-keyword">if</span>(options.<span class="hljs-property">event_listeners</span>) <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(options.<span class="hljs-property">event_listeners</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> node.<span class="hljs-title function_">addEventListener</span>(key,options.<span class="hljs-property">event_listeners</span>[key]) )
        <span class="hljs-keyword">if</span>(options.<span class="hljs-property">root</span>) options.<span class="hljs-property">root</span>.<span class="hljs-title function_">appendChild</span>(node);
        <span class="hljs-keyword">return</span> node;
      }
      <span class="hljs-keyword">class</span> <span class="hljs-title class_">App</span> {
        <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>){
          <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;DOMContentLoaded&#x27;</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">handleReady</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
        }
        <span class="hljs-title function_">handleReady</span>(<span class="hljs-params"></span>){
          <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">interval</span>) <span class="hljs-title function_">cancelAnimationFrame</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">interval</span>);
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">els</span> = {};
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">video_playing</span> = <span class="hljs-literal">false</span>;
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">ready</span> = <span class="hljs-literal">false</span>;
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">effect_on</span> = <span class="hljs-literal">false</span>;
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">els</span>.<span class="hljs-property">root</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;root&#x27;</span>);
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">els</span>.<span class="hljs-property">root</span>.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">``</span>;
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">video</span> = <span class="hljs-title function_">createNode</span>({ <span class="hljs-attr">tag</span>: <span class="hljs-string">&#x27;video&#x27;</span>, <span class="hljs-attr">attributes</span>: { <span class="hljs-attr">src</span>: <span class="hljs-string">`geisha.mp4`</span>, <span class="hljs-attr">loop</span>: <span class="hljs-string">&#x27;true&#x27;</span>, <span class="hljs-attr">playsinline</span>: <span class="hljs-string">&#x27;true&#x27;</span> } })
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">els</span>.<span class="hljs-property">canvas</span> = <span class="hljs-title function_">createNode</span>({ <span class="hljs-attr">root</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">els</span>.<span class="hljs-property">root</span>, <span class="hljs-attr">tag</span>: <span class="hljs-string">&#x27;canvas&#x27;</span> });
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">els</span>.<span class="hljs-property">canvas</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {
            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">video_playing</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">video</span>.<span class="hljs-title function_">pause</span>();
            <span class="hljs-keyword">else</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">video</span>.<span class="hljs-title function_">play</span>();
          });
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">els</span>.<span class="hljs-property">canvas</span>.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">&#x27;2d&#x27;</span>);
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">els</span>.<span class="hljs-property">start</span> = <span class="hljs-title function_">createNode</span>({ <span class="hljs-attr">root</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">els</span>.<span class="hljs-property">root</span>, <span class="hljs-attr">tag</span>: <span class="hljs-string">&#x27;div&#x27;</span>, <span class="hljs-attr">className</span>: <span class="hljs-string">&#x27;start&#x27;</span> })
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">els</span>.<span class="hljs-property">start_button</span> = <span class="hljs-title function_">createNode</span>({ <span class="hljs-attr">root</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">els</span>.<span class="hljs-property">start</span>, <span class="hljs-attr">tag</span>: <span class="hljs-string">&#x27;button&#x27;</span>, <span class="hljs-attr">innerHTML</span>: <span class="hljs-string">&#x27;Click to load video&#x27;</span> })
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">els</span>.<span class="hljs-property">start_button</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">handleClickStart</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
          <span class="hljs-comment">// this.els.start.addEventListener(&#x27;touchstart&#x27;,this.handleClickStart.bind(this));</span>
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">video</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;loadedmetadata&#x27;</span>, <span class="hljs-keyword">async</span> event =&gt; {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">els</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">width</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">video</span>.<span class="hljs-property">videoWidth</span>;
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">els</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">height</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">video</span>.<span class="hljs-property">videoHeight</span>;
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">els</span>.<span class="hljs-property">action</span> = <span class="hljs-keyword">await</span> <span class="hljs-title function_">createNode</span>({ <span class="hljs-attr">root</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">els</span>.<span class="hljs-property">root</span>, <span class="hljs-attr">tag</span>: <span class="hljs-string">&#x27;button&#x27;</span>, <span class="hljs-attr">className</span>: <span class="hljs-string">&#x27;action&#x27;</span>, <span class="hljs-attr">innerHTML</span>: <span class="hljs-string">&#x27;Toggle effect&#x27;</span>, <span class="hljs-attr">style</span>: { <span class="hljs-attr">display</span>: <span class="hljs-string">`none`</span> } })
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">els</span>.<span class="hljs-property">action</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {
              <span class="hljs-variable language_">this</span>.<span class="hljs-property">effect_on</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">effect_on</span>;
            });
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">interval</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">render</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
          })
        }
        <span class="hljs-keyword">async</span> <span class="hljs-title function_">handleClickStart</span>(<span class="hljs-params">event</span>){
          <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">video</span>.<span class="hljs-title function_">play</span>();
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">els</span>.<span class="hljs-property">start</span>.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">`none`</span>;
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">els</span>.<span class="hljs-property">action</span>.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">`block`</span>;
        }
        <span class="hljs-title function_">rgbSplit</span>(<span class="hljs-params">imageData, options</span>) {
          <span class="hljs-comment">// https://hangindev.com/blog/rgb-splitting-effect-with-html5-canvas-and-javascript</span>
          <span class="hljs-keyword">const</span> { rOffset = <span class="hljs-number">0</span>, gOffset = <span class="hljs-number">0</span>, bOffset = <span class="hljs-number">0</span> } = options;
          <span class="hljs-keyword">const</span> originalArray = imageData.<span class="hljs-property">data</span>;
          <span class="hljs-keyword">const</span> newPixels = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8ClampedArray</span>(originalArray);
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; originalArray.<span class="hljs-property">length</span>; i += <span class="hljs-number">4</span>) {
            newPixels[i + <span class="hljs-number">0</span> + rOffset * <span class="hljs-number">4</span>] = originalArray[i + <span class="hljs-number">0</span>]; <span class="hljs-comment">// 🔴</span>
            newPixels[i + <span class="hljs-number">1</span> + gOffset * <span class="hljs-number">4</span>] = originalArray[i + <span class="hljs-number">1</span>]; <span class="hljs-comment">// 🟢</span>
            newPixels[i + <span class="hljs-number">2</span> + bOffset * <span class="hljs-number">4</span>] = originalArray[i + <span class="hljs-number">2</span>]; <span class="hljs-comment">// 🔵</span>
          }
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageData</span>(newPixels, imageData.<span class="hljs-property">width</span>, imageData.<span class="hljs-property">height</span>);
        }
        <span class="hljs-title function_">drawVideo</span>(<span class="hljs-params"></span>){
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">drawImage</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">video</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">video</span>.<span class="hljs-property">videoWidth</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">video</span>.<span class="hljs-property">videoHeight</span>);
          <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">effect_on</span>){
            <span class="hljs-keyword">const</span> imageData = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">getImageData</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">video</span>.<span class="hljs-property">videoWidth</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">video</span>.<span class="hljs-property">videoHeight</span>);
            <span class="hljs-keyword">const</span> updatedImageData = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">rgbSplit</span>(imageData, { <span class="hljs-attr">rOffset</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">gOffset</span>: -<span class="hljs-number">10</span>, <span class="hljs-attr">bOffset</span>: <span class="hljs-number">10</span> });
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">putImageData</span>(updatedImageData, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
          }
        }
        <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>){
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">video_playing</span> = !!(<span class="hljs-variable language_">this</span>.<span class="hljs-property">video</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">video</span>.<span class="hljs-property">currentTime</span> &gt; <span class="hljs-number">0</span> &amp;&amp; !<span class="hljs-variable language_">this</span>.<span class="hljs-property">video</span>.<span class="hljs-property">paused</span> &amp;&amp; !<span class="hljs-variable language_">this</span>.<span class="hljs-property">video</span>.<span class="hljs-property">ended</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">video</span>.<span class="hljs-property">readyState</span> &gt; <span class="hljs-number">2</span>);
          <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">video_playing</span>){
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawVideo</span>();
          }
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">interval</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">render</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
        }
      }
      <span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">App</span>();
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
   <p>To demonstrate, I'll use some raw footage of the geisha from Bladerunner I converted into an mp4 file. Click the document to initiate the vide playback. Click the document again to pause/resume. Toggle the effect on/off with the button.</p>
   <p>In this case, I took some time to find a function which splits the RGB values of image pixel data. There are a myriad of complex solutions for image manipulation, and I was quite surprised at how easy and fast this solution turned out to be.</p>
   <p>Using requestAnimationFrame, I draw each frame of the video, get its pixel data, apply the filter, and redraw to the canvas.</p>
   <p><strong>Project Assets</strong></p>
   <table>
    <thead>
     <tr>
      <th style="text-align:left">Asset</th>
      <th style="text-align:left">File</th>
      <th style="text-align:left">Description</th>
     </tr>
    </thead>
    <tbody>
     <tr>
      <td style="text-align:left"><code>geisha.mp4</code></td>
      <td style="text-align:left"><a href="https://iamjohnmills.github.io/journal/canvas-video/geisha.mp4">Download</a></td>
      <td style="text-align:left">Video file of the smoking geisha from Bladerunner</td>
     </tr>
    </tbody>
   </table>
   <aside>
    <figure>
     <img src="https://iamjohnmills.github.io/journal/assets/jm-photo-2023.jpg" />
    </figure>
    <p>I'm John Mills, a professional frontend engineer. Here I share my experiences and journeys with all of you. Check out all my projects on <a href="https://github.com/iamjohnmills" target="_blank">Github</a>. Message or connect with me on <a href="https://www.linkedin.com/in/iamjohnmills" target="_blank">LinkedIn</a>. I'm a proud dad of my two daughters, cook sometimes, and am interested in a ton of weird stuff.</p>
   </aside>
  </section>
 </main>
</body>

</html>