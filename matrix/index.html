<html>

<head>
 <title>John Mills</title>
 <meta charset="utf-8">
 <meta name="viewport" content="width=device-width">
 <link rel="stylesheet" href="https://iamjohnmills.github.io/journal/assets/site.css" />
 <script src="https://iamjohnmills.github.io/journal/assets/site.js"></script>
</head>

<body>
 <header>
  <div data-toggle-nav="true">
   <svg width="16" height="16" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path fill="#33363F" d="m4 10-.707.707L2.586 10l.707-.707L4 10Zm17 8a1 1 0 1 1-2 0h2ZM8.293 15.707l-5-5 1.414-1.414 5 5-1.414 1.414Zm-5-6.414 5-5 1.414 1.414-5 5-1.414-1.414ZM4 9h10v2H4V9Zm17 7v2h-2v-2h2Zm-7-7a7 7 0 0 1 7 7h-2a5 5 0 0 0-5-5V9Z" />
   </svg> More Articles
  </div>
  <a class="button" href="https://iamjohnmills.github.io/journal/johnmills.rss">
   <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 100 100" xml:space="preserve">
    <path d="M26.258 64.949a8.78 8.78 0 0 0-8.78 8.784 8.782 8.782 0 1 0 17.564 0 8.78 8.78 0 0 0-8.784-8.784z" />
    <path d="M23.536 40.801c-.046 0-.09.006-.135.007v-.007h-3.464v.039a3.437 3.437 0 0 0-3.056 3.344h-.007v6.159h.041a3.43 3.43 0 0 0 3.021 3.002v.039H23.4v-.048c.045.001.09.007.135.007 12.772 0 23.173 10.321 23.311 23.061h-.033v3.464h.039a3.437 3.437 0 0 0 3.344 3.056v.007h6.158v-.041a3.43 3.43 0 0 0 3.002-3.021h.039v-3.464h-.006c-.137-19.657-16.166-35.604-35.853-35.604z" />
    <path d="M83.119 76.403C82.98 43.664 56.308 17.07 23.536 17.07c-.046 0-.09.006-.135.007v-.007h-3.464v.039a3.437 3.437 0 0 0-3.056 3.344h-.007v6.159h.041a3.429 3.429 0 0 0 3.021 3.002v.039H23.4v-.048c.045.001.09.007.135.007 25.857 0 46.902 20.967 47.041 46.792h-.035v3.464h.039a3.437 3.437 0 0 0 3.344 3.056v.007h6.159v-.041a3.43 3.43 0 0 0 3.002-3.021h.039v-3.464h-.005z" />
   </svg> RSS </a>
 </header>
 <main>
  <nav>
   <span>I mostly post minimal experiments, tips, and tricks. Keep up-to-date with me and subscribe to my <a href="https://iamjohnmills.github.io/journal/johnmills.rss" target="_blank">RSS Feed</a></span>
   <a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;animated-nav-icon&#x2F;">Animated Nav Menu</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;vector-earth&#x2F;">Vector Earth 3D</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;giftv&#x2F;">GifTV</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;shaders&#x2F;">WebGL shaders</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;n64&#x2F;">Spinning N64 logo</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;chat-bubbles&#x2F;">Chat bubbles</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;canvas-video&#x2F;">Video to canvas</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;90s-shapes&#x2F;">90s abstract shapes</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;equalizer&#x2F;">Animated equalizer</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;synthwave-highway&#x2F;">Synthwave highway</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;plasma&#x2F;">Plasma</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;matrix&#x2F;">Matrix</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;cursor-follow&#x2F;">Follow mouse cursor</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;game-of-life&#x2F;">Game of life</a><a href="https:&#x2F;&#x2F;iamjohnmills.github.io&#x2F;journal&#x2F;create-node&#x2F;">My one-function JS framework</a>
  </nav>
  <section>
   <p>Jan 2023</p>
   <h1>Matrix</h1>
   <p>Here I explore creating a performant falling green code animation from the Matrix using canvas.</p>
   <pre data-code="%3Chtml%3E%0A%20%20%3Chead%3E%0A%20%20%20%20%3Cmeta%20charset%3D%22utf-8%22%3E%0A%20%20%20%20%3Clink%20rel%3D%22preload%22%20href%3D%22matrix.ttf%22%20as%3D%22font%22%20type%3D%22font%2Fttf%22%3E%0A%20%20%20%20%3Cstyle%3E%0A%20%20%20%20%20%20%40font-face%20%7B%20font-family%3A%20matrix%3B%20src%3A%20url(matrix.ttf)%3B%20%7D%0A%20%20%20%20%20%20*%20%7B%20box-sizing%3A%20border-box%3B%20%7D%0A%20%20%20%20%20%20html%2Cbody%20%7B%20margin%3A%200%3B%20background%3A%20%23000%3B%20overflow%3A%20hidden%3B%20height%3A%20100%25%3B%20%7D%0A%20%20%20%20%20%20%23root%20%7B%20width%3A%20100%25%3B%20height%3A%20100%25%3B%20%7D%0A%20%20%20%20%20%20canvas%20%7B%20width%3A%20100%25%3B%20height%3A%20100%25%3B%20object-fit%3A%20cover%3B%7D%0A%20%20%20%20%20%20.fps%20%7B%20position%3A%20absolute%3B%20left%3A%2030px%3B%20bottom%3A%2030px%3B%20font-size%3A%2014px%3B%20font-family%3A%20monospace%3B%20color%3A%20%23ffffd1%3B%20z-index%3A%202%3B%20%7D%0A%20%20%20%20%20%20%3C%2Fstyle%3E%0A%20%20%20%20%3Cscript%3E%0A%20%20%20%20const%20createNode%20%3D%20(options)%20%3D%3E%20%7B%0A%20%20%20%20%20%20const%20node%20%3D%20document.createElement(options.tag)%3B%0A%20%20%20%20%20%20if(options.className)%20node.setAttribute('class'%2Coptions.className)%3B%0A%20%20%20%20%20%20if(options.innerHTML)%20node.innerHTML%20%3D%20options.innerHTML%3B%0A%20%20%20%20%20%20if(options.attributes)%20Object.keys(options.attributes).forEach(key%20%3D%3E%20node.setAttribute(key%2Coptions.attributes%5Bkey%5D)%20)%3B%0A%20%20%20%20%20%20if(options.style)%20Object.keys(options.style).forEach(key%20%3D%3E%20node.style%5Bkey%5D%20%3D%20options.style%5Bkey%5D)%3B%0A%20%20%20%20%20%20if(options.root)%20options.root.appendChild(node)%3B%0A%20%20%20%20%20%20return%20node%3B%0A%20%20%20%20%7D%0A%20%20%20%20class%20Matrix%20%7B%0A%20%20%20%20%20%20constructor()%7B%0A%20%20%20%20%20%20%20%20window.addEventListener('resize'%2Cthis.init.bind(this))%3B%0A%20%20%20%20%20%20%20%20document.addEventListener('DOMContentLoaded'%2Cthis.init.bind(this))%3B%0A%20%20%20%20%20%20%20%20this.glyphs%20%3D%20%5B'%E3%83%A2'%2C'%E3%82%A8'%2C'%E3%83%A4'%2C'%E3%82%AD'%2C'%E3%82%AA'%2C'%E3%82%AB'%2C'7'%2C'%E3%82%B1'%2C'%E3%82%B5'%2C'%E3%82%B9'%2C'z'%2C'1'%2C'5'%2C'2'%2C'%E3%83%A8'%2C'%E3%82%BF'%2C'%E3%83%AF'%2C'4'%2C'%E3%83%8D'%2C'%E3%83%8C'%2C'%E3%83%8A'%2C'9'%2C'8'%2C'%E3%83%92'%2C'0'%2C'%E3%83%9B'%2C'%E3%82%A2'%2C'3'%2C'%E3%82%A6'%2C'%20'%2C'%E3%82%BB'%2C'%C2%A6'%2C'%3A'%2C'%22'%2C'%EA%9E%8A'%2C'%E3%83%9F'%2C'%E3%83%A9'%2C'%E3%83%AA'%2C'%E2%95%8C'%2C'%E3%83%84'%2C'%E3%83%86'%2C'%E3%83%8B'%2C'%E3%83%8F'%2C'%E3%82%BD'%2C'%E2%96%AA'%2C'%E2%80%94'%2C'%3C'%2C'%3E'%2C'0'%2C'%7C'%2C'%2B'%2C'*'%2C'%E3%82%B3'%2C'%E3%82%B7'%2C'%E3%83%9E'%2C'%E3%83%A0'%2C'%E3%83%A1'%5D%3B%0A%20%20%20%20%20%20%20%20this.message%20%3D%20'GITHUB.COM%2FIAMJOHNMILLS'%3B%0A%20%20%20%20%20%20%20%20this.glyph_size%20%3D%2012%3B%0A%20%20%20%20%20%20%20%20this.trail_length%20%3D%2025%3B%0A%20%20%20%20%20%20%20%20this.alpha_step%20%3D%20(1%20%2F%20this.trail_length)%20*%20100%3B%0A%20%20%20%20%20%20%20%20this.els%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20async%20init()%7B%0A%20%20%20%20%20%20%20%20if(this.interval)%20cancelAnimationFrame(this.interval)%3B%0A%20%20%20%20%20%20%20%20this.width%20%3D%20window.innerWidth%3B%0A%20%20%20%20%20%20%20%20this.height%20%3D%20window.innerHeight%3B%0A%20%20%20%20%20%20%20%20this.root%20%3D%20document.getElementById('root')%3B%0A%20%20%20%20%20%20%20%20this.root.innerHTML%20%3D%20%60%60%3B%0A%20%20%20%20%20%20%20%20this.max_columns%20%3D%20Math.ceil(this.width%20%2F%20this.glyph_size)%3B%0A%20%20%20%20%20%20%20%20this.max_rows%20%3D%20Math.ceil(this.height%20%2F%20this.glyph_size)%3B%0A%20%20%20%20%20%20%20%20this.rows_center%20%3D%20Math.floor(this.max_rows%20%2F%202)%3B%0A%20%20%20%20%20%20%20%20this.columns_center%20%3D%20Math.floor(this.max_columns%20%2F%202)%3B%0A%20%20%20%20%20%20%20%20this.overflow%20%3D%20this.max_rows%20%2B%2040%3B%0A%20%20%20%20%20%20%20%20this.els.fps%20%3D%20createNode(%7B%20root%3A%20this.root%2C%20tag%3A%20'div'%2C%20className%3A%20%60fps%60%2C%20style%3A%20%7B%20display%3A%20%60none%60%20%7D%20%7D)%3B%0A%20%20%20%20%20%20%20%20this.els.canvas%20%3D%20createNode(%7B%20root%3A%20this.root%2C%20tag%3A%20'canvas'%2C%20attributes%3A%20%7B%20width%3A%20this.width%2C%20height%3A%20this.height%20%7D%20%7D)%3B%0A%20%20%20%20%20%20%20%20this.context%20%3D%20this.els.canvas.getContext('2d')%3B%0A%20%20%20%20%20%20%20%20this.matrix%20%3D%20this.generate()%3B%0A%20%20%20%20%20%20%20%20this.interval%20%3D%20window.requestAnimationFrame(this.render.bind(this))%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20async%20render()%7B%0A%20%20%20%20%20%20%20%20this.context.clearRect(0%2C%200%2C%20this.width%2C%20this.height)%3B%0A%20%20%20%20%20%20%20%20for(let%20x%20%3D%200%3B%20x%20%3C%20this.matrix.length%3B%20x%2B%2B)%7B%0A%20%20%20%20%20%20%20%20%20%20const%20column%20%3D%20this.matrix%5Bx%5D%3B%0A%20%20%20%20%20%20%20%20%20%20let%20position%20%3D%20column.drop_position%20%2B%20(1%20*%20column.drop_speed)%3B%0A%20%20%20%20%20%20%20%20%20%20column.drop_position%20%3D%20position%20%3E%20this.overflow%20%3F%200%20%3A%20position%3B%0A%20%20%20%20%20%20%20%20%20%20let%20position_y%20%3D%20Math.floor(column.drop_position)%3B%0A%20%20%20%20%20%20%20%20%20%20for(let%20y%20%3D%200%3B%20y%20%3C%20column.glyphs.length%3B%20y%2B%2B)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20row%20%3D%20column.glyphs%5By%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20let%20render_x%20%3D%20x%20*%20this.glyph_size%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20let%20render_y%20%3D%20y%20*%20this.glyph_size%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if(row.active)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20row.active%20%3D%20!!row.letter%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.context.font%20%3D%20'bold%2011px%20sans-serif'%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.context.fillStyle%20%3D%20'%23ffffd1'%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20letter_width%20%3D%20this.context.measureText(row.letter.letter).width%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20render_x%20%3D%20((this.glyph_size%20-%20letter_width)%20%2F%202)%20%2B%20render_x%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.context.fillText(row.letter.letter%2C%20render_x%2C%20render_y)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20if(y%20%3C%20position_y)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20position_spread%20%3D%20position_y%20-%20y%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(position_spread%20%3C%3D%20this.trail_length%20%26%26%20position_spread%20%3E%200)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20alpha%20%3D%20(100%20-%20position_spread%20*%20this.alpha_step)%20%2F%20100%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.context.font%20%3D%20'11px%20matrix'%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.context.fillStyle%20%3D%20%60rgba(180%2C255%2C160%2C%24%7Balpha%7D)%60%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.context.fillText(row.glyph%2C%20render_x%2C%20render_y)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20if(y%20%3D%3D%3D%20position_y)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20row.active%20%3D%20!!row.letter%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.context.font%20%3D%20'11px%20matrix'%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.context.fillStyle%20%3D%20'%23ffffd1'%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.context.fillText(row.glyph%2C%20render_x%2C%20render_y)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20if(x%20%3D%3D%3D%20this.matrix.length%20-%201%20%26%26%20y%20%3D%3D%3D%20column.glyphs.length%20-%201)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.interval%20%3D%20window.requestAnimationFrame(this.render.bind(this))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20generate()%7B%0A%20%20%20%20%20%20%20%20const%20message_parts%20%3D%20this.message.split('')%3B%0A%20%20%20%20%20%20%20%20const%20message_start%20%3D%20this.columns_center%20-%20(Math.floor(message_parts.length%20%2F%202))%3B%0A%20%20%20%20%20%20%20%20const%20message_letters%20%3D%20message_parts.map(%20(message_part%2Ci)%20%3D%3E%20(%7B%20position%3A%20message_start%20%2B%20i%2C%20letter%3A%20message_part%20%7D))%0A%20%20%20%20%20%20%20%20return%20Array.from(Array(this.max_columns)).map((column%2Cx)%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20return%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20drop_position%3A%20Math.floor(Math.random()*this.max_rows)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20drop_speed%3A%20Math.random()%20*%20(0.5%20-%200.1)%20%2B%200.1%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20glyphs%3A%20Array.from(Array(this.max_rows)).map((row%2Cy)%20%3D%3E%20(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20active%3A%20false%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20glyph%3A%20this.glyphs%5BMath.floor(Math.random()*this.glyphs.length)%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20letter%3A%20message_letters.find(message_letter%20%3D%3E%20message_letter.position%20%3D%3D%3D%20x%20%26%26%20this.rows_center%20%3D%3D%3D%20y)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D)%20)%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20const%20matrix%20%3D%20new%20Matrix()%3B%0A%20%20%20%20%3C%2Fscript%3E%0A%20%20%3C%2Fhead%3E%0A%20%20%3Cbody%3E%0A%20%20%20%20%3Cdiv%20id%3D%22root%22%3E%3C%2Fdiv%3E%0A%20%20%3C%2Fbody%3E%0A%3C%2Fhtml%3E%0A"><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;preload&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;matrix.ttf&quot;</span> <span class="hljs-attr">as</span>=<span class="hljs-string">&quot;font&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;font/ttf&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css">
      <span class="hljs-keyword">@font-face</span> { <span class="hljs-attribute">font-family</span>: matrix; <span class="hljs-attribute">src</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">matrix.ttf</span>); }
      * { <span class="hljs-attribute">box-sizing</span>: border-box; }
      <span class="hljs-selector-tag">html</span>,<span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">background</span>: <span class="hljs-number">#000</span>; <span class="hljs-attribute">overflow</span>: hidden; <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>; }
      <span class="hljs-selector-id">#root</span> { <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>; }
      <span class="hljs-selector-tag">canvas</span> { <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>; <span class="hljs-attribute">object-fit</span>: cover;}
      <span class="hljs-selector-class">.fps</span> { <span class="hljs-attribute">position</span>: absolute; <span class="hljs-attribute">left</span>: <span class="hljs-number">30px</span>; <span class="hljs-attribute">bottom</span>: <span class="hljs-number">30px</span>; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>; <span class="hljs-attribute">font-family</span>: monospace; <span class="hljs-attribute">color</span>: <span class="hljs-number">#ffffd1</span>; <span class="hljs-attribute">z-index</span>: <span class="hljs-number">2</span>; }
      </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript">
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">createNode</span> = (<span class="hljs-params">options</span>) =&gt; {
      <span class="hljs-keyword">const</span> node = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(options.<span class="hljs-property">tag</span>);
      <span class="hljs-keyword">if</span>(options.<span class="hljs-property">className</span>) node.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;class&#x27;</span>,options.<span class="hljs-property">className</span>);
      <span class="hljs-keyword">if</span>(options.<span class="hljs-property">innerHTML</span>) node.<span class="hljs-property">innerHTML</span> = options.<span class="hljs-property">innerHTML</span>;
      <span class="hljs-keyword">if</span>(options.<span class="hljs-property">attributes</span>) <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(options.<span class="hljs-property">attributes</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> node.<span class="hljs-title function_">setAttribute</span>(key,options.<span class="hljs-property">attributes</span>[key]) );
      <span class="hljs-keyword">if</span>(options.<span class="hljs-property">style</span>) <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(options.<span class="hljs-property">style</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> node.<span class="hljs-property">style</span>[key] = options.<span class="hljs-property">style</span>[key]);
      <span class="hljs-keyword">if</span>(options.<span class="hljs-property">root</span>) options.<span class="hljs-property">root</span>.<span class="hljs-title function_">appendChild</span>(node);
      <span class="hljs-keyword">return</span> node;
    }
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Matrix</span> {
      <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>){
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">init</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;DOMContentLoaded&#x27;</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">init</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">glyphs</span> = [<span class="hljs-string">&#x27;モ&#x27;</span>,<span class="hljs-string">&#x27;エ&#x27;</span>,<span class="hljs-string">&#x27;ヤ&#x27;</span>,<span class="hljs-string">&#x27;キ&#x27;</span>,<span class="hljs-string">&#x27;オ&#x27;</span>,<span class="hljs-string">&#x27;カ&#x27;</span>,<span class="hljs-string">&#x27;7&#x27;</span>,<span class="hljs-string">&#x27;ケ&#x27;</span>,<span class="hljs-string">&#x27;サ&#x27;</span>,<span class="hljs-string">&#x27;ス&#x27;</span>,<span class="hljs-string">&#x27;z&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;5&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;ヨ&#x27;</span>,<span class="hljs-string">&#x27;タ&#x27;</span>,<span class="hljs-string">&#x27;ワ&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>,<span class="hljs-string">&#x27;ネ&#x27;</span>,<span class="hljs-string">&#x27;ヌ&#x27;</span>,<span class="hljs-string">&#x27;ナ&#x27;</span>,<span class="hljs-string">&#x27;9&#x27;</span>,<span class="hljs-string">&#x27;8&#x27;</span>,<span class="hljs-string">&#x27;ヒ&#x27;</span>,<span class="hljs-string">&#x27;0&#x27;</span>,<span class="hljs-string">&#x27;ホ&#x27;</span>,<span class="hljs-string">&#x27;ア&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;ウ&#x27;</span>,<span class="hljs-string">&#x27; &#x27;</span>,<span class="hljs-string">&#x27;セ&#x27;</span>,<span class="hljs-string">&#x27;¦&#x27;</span>,<span class="hljs-string">&#x27;:&#x27;</span>,<span class="hljs-string">&#x27;&quot;&#x27;</span>,<span class="hljs-string">&#x27;꞊&#x27;</span>,<span class="hljs-string">&#x27;ミ&#x27;</span>,<span class="hljs-string">&#x27;ラ&#x27;</span>,<span class="hljs-string">&#x27;リ&#x27;</span>,<span class="hljs-string">&#x27;╌&#x27;</span>,<span class="hljs-string">&#x27;ツ&#x27;</span>,<span class="hljs-string">&#x27;テ&#x27;</span>,<span class="hljs-string">&#x27;ニ&#x27;</span>,<span class="hljs-string">&#x27;ハ&#x27;</span>,<span class="hljs-string">&#x27;ソ&#x27;</span>,<span class="hljs-string">&#x27;▪&#x27;</span>,<span class="hljs-string">&#x27;—&#x27;</span>,<span class="hljs-string">&#x27;&lt;&#x27;</span>,<span class="hljs-string">&#x27;&gt;&#x27;</span>,<span class="hljs-string">&#x27;0&#x27;</span>,<span class="hljs-string">&#x27;|&#x27;</span>,<span class="hljs-string">&#x27;+&#x27;</span>,<span class="hljs-string">&#x27;*&#x27;</span>,<span class="hljs-string">&#x27;コ&#x27;</span>,<span class="hljs-string">&#x27;シ&#x27;</span>,<span class="hljs-string">&#x27;マ&#x27;</span>,<span class="hljs-string">&#x27;ム&#x27;</span>,<span class="hljs-string">&#x27;メ&#x27;</span>];
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">&#x27;GITHUB.COM/IAMJOHNMILLS&#x27;</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">glyph_size</span> = <span class="hljs-number">12</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">trail_length</span> = <span class="hljs-number">25</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">alpha_step</span> = (<span class="hljs-number">1</span> / <span class="hljs-variable language_">this</span>.<span class="hljs-property">trail_length</span>) * <span class="hljs-number">100</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">els</span> = [];
      }
      <span class="hljs-keyword">async</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"></span>){
        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">interval</span>) <span class="hljs-title function_">cancelAnimationFrame</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">interval</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">height</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">root</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;root&#x27;</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">root</span>.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">``</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">max_columns</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span> / <span class="hljs-variable language_">this</span>.<span class="hljs-property">glyph_size</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">max_rows</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">height</span> / <span class="hljs-variable language_">this</span>.<span class="hljs-property">glyph_size</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">rows_center</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">max_rows</span> / <span class="hljs-number">2</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">columns_center</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">max_columns</span> / <span class="hljs-number">2</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">overflow</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">max_rows</span> + <span class="hljs-number">40</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">els</span>.<span class="hljs-property">fps</span> = <span class="hljs-title function_">createNode</span>({ <span class="hljs-attr">root</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">root</span>, <span class="hljs-attr">tag</span>: <span class="hljs-string">&#x27;div&#x27;</span>, <span class="hljs-attr">className</span>: <span class="hljs-string">`fps`</span>, <span class="hljs-attr">style</span>: { <span class="hljs-attr">display</span>: <span class="hljs-string">`none`</span> } });
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">els</span>.<span class="hljs-property">canvas</span> = <span class="hljs-title function_">createNode</span>({ <span class="hljs-attr">root</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">root</span>, <span class="hljs-attr">tag</span>: <span class="hljs-string">&#x27;canvas&#x27;</span>, <span class="hljs-attr">attributes</span>: { <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span>, <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">height</span> } });
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">els</span>.<span class="hljs-property">canvas</span>.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">&#x27;2d&#x27;</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">matrix</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">generate</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">interval</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">render</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
      }
      <span class="hljs-keyword">async</span> <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>){
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">clearRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">height</span>);
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> x = <span class="hljs-number">0</span>; x &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">matrix</span>.<span class="hljs-property">length</span>; x++){
          <span class="hljs-keyword">const</span> column = <span class="hljs-variable language_">this</span>.<span class="hljs-property">matrix</span>[x];
          <span class="hljs-keyword">let</span> position = column.<span class="hljs-property">drop_position</span> + (<span class="hljs-number">1</span> * column.<span class="hljs-property">drop_speed</span>);
          column.<span class="hljs-property">drop_position</span> = position &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">overflow</span> ? <span class="hljs-number">0</span> : position;
          <span class="hljs-keyword">let</span> position_y = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(column.<span class="hljs-property">drop_position</span>);
          <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> y = <span class="hljs-number">0</span>; y &lt; column.<span class="hljs-property">glyphs</span>.<span class="hljs-property">length</span>; y++){
            <span class="hljs-keyword">const</span> row = column.<span class="hljs-property">glyphs</span>[y];
            <span class="hljs-keyword">let</span> render_x = x * <span class="hljs-variable language_">this</span>.<span class="hljs-property">glyph_size</span>;
            <span class="hljs-keyword">let</span> render_y = y * <span class="hljs-variable language_">this</span>.<span class="hljs-property">glyph_size</span>;
            <span class="hljs-keyword">if</span>(row.<span class="hljs-property">active</span>){
              row.<span class="hljs-property">active</span> = !!row.<span class="hljs-property">letter</span>;
              <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">font</span> = <span class="hljs-string">&#x27;bold 11px sans-serif&#x27;</span>;
              <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">&#x27;#ffffd1&#x27;</span>;
              <span class="hljs-keyword">const</span> letter_width = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">measureText</span>(row.<span class="hljs-property">letter</span>.<span class="hljs-property">letter</span>).<span class="hljs-property">width</span>;
              render_x = ((<span class="hljs-variable language_">this</span>.<span class="hljs-property">glyph_size</span> - letter_width) / <span class="hljs-number">2</span>) + render_x;
              <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">fillText</span>(row.<span class="hljs-property">letter</span>.<span class="hljs-property">letter</span>, render_x, render_y);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(y &lt; position_y){
              <span class="hljs-keyword">const</span> position_spread = position_y - y;
              <span class="hljs-keyword">if</span>(position_spread &lt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">trail_length</span> &amp;&amp; position_spread &gt; <span class="hljs-number">0</span>){
                <span class="hljs-keyword">let</span> alpha = (<span class="hljs-number">100</span> - position_spread * <span class="hljs-variable language_">this</span>.<span class="hljs-property">alpha_step</span>) / <span class="hljs-number">100</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">font</span> = <span class="hljs-string">&#x27;11px matrix&#x27;</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">`rgba(180,255,160,<span class="hljs-subst">${alpha}</span>)`</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">fillText</span>(row.<span class="hljs-property">glyph</span>, render_x, render_y);
              }
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(y === position_y){
              row.<span class="hljs-property">active</span> = !!row.<span class="hljs-property">letter</span>;
              <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">font</span> = <span class="hljs-string">&#x27;11px matrix&#x27;</span>;
              <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">&#x27;#ffffd1&#x27;</span>;
              <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">fillText</span>(row.<span class="hljs-property">glyph</span>, render_x, render_y);
            }
            <span class="hljs-keyword">if</span>(x === <span class="hljs-variable language_">this</span>.<span class="hljs-property">matrix</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span> &amp;&amp; y === column.<span class="hljs-property">glyphs</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) {
              <span class="hljs-variable language_">this</span>.<span class="hljs-property">interval</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">render</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
            }
          }
        }
      }
      <span class="hljs-title function_">generate</span>(<span class="hljs-params"></span>){
        <span class="hljs-keyword">const</span> message_parts = <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;&#x27;</span>);
        <span class="hljs-keyword">const</span> message_start = <span class="hljs-variable language_">this</span>.<span class="hljs-property">columns_center</span> - (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(message_parts.<span class="hljs-property">length</span> / <span class="hljs-number">2</span>));
        <span class="hljs-keyword">const</span> message_letters = message_parts.<span class="hljs-title function_">map</span>( <span class="hljs-function">(<span class="hljs-params">message_part,i</span>) =&gt;</span> ({ <span class="hljs-attr">position</span>: message_start + i, <span class="hljs-attr">letter</span>: message_part }))
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-title class_">Array</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">max_columns</span>)).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">column,x</span>) =&gt;</span> {
          <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">drop_position</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()*<span class="hljs-variable language_">this</span>.<span class="hljs-property">max_rows</span>),
            <span class="hljs-attr">drop_speed</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * (<span class="hljs-number">0.5</span> - <span class="hljs-number">0.1</span>) + <span class="hljs-number">0.1</span>,
            <span class="hljs-attr">glyphs</span>: <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-title class_">Array</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">max_rows</span>)).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">row,y</span>) =&gt;</span> ({
              <span class="hljs-attr">active</span>: <span class="hljs-literal">false</span>,
              <span class="hljs-attr">glyph</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">glyphs</span>[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()*<span class="hljs-variable language_">this</span>.<span class="hljs-property">glyphs</span>.<span class="hljs-property">length</span>)],
              <span class="hljs-attr">letter</span>: message_letters.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">message_letter</span> =&gt;</span> message_letter.<span class="hljs-property">position</span> === x &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">rows_center</span> === y),
            }) )
          }
        });
      }
    }
    <span class="hljs-keyword">const</span> matrix = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Matrix</span>();
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
   <p>The first step is to find the font used, because without it, it doesn't look quite right. Each glyph is then defined in an array and a random one is chosen to be placed at a coordinate derived from the canvas width and height and glyph size.</p>
   <p>Once the matrix is generated, the requestAnimationFrame is triggered and on each iteration, each column has a current position value that is updated. By applying an RGB color based on column drop speed and current position values, a simulated movement effect is created.</p>
   <p><strong>Project Assets</strong></p>
   <table>
    <thead>
     <tr>
      <th style="text-align:left">Asset</th>
      <th style="text-align:left">File</th>
      <th style="text-align:left">Description</th>
     </tr>
    </thead>
    <tbody>
     <tr>
      <td style="text-align:left"><code>matrix.ttf</code></td>
      <td style="text-align:left"><a href="https://iamjohnmills.github.io/journal/matrix/matrix.ttf">Download</a></td>
      <td style="text-align:left">Font used to make the glyphs look nice.</td>
     </tr>
    </tbody>
   </table>
   <aside>
    <figure>
     <img src="https://iamjohnmills.github.io/journal/assets/jm-photo-2023.jpg" />
    </figure>
    <p>I'm John Mills, a professional frontend engineer. Here I share my experiences and journeys with all of you. Check out all my projects on <a href="https://github.com/iamjohnmills" target="_blank">Github</a>. Message or connect with me on <a href="https://www.linkedin.com/in/iamjohnmills" target="_blank">LinkedIn</a>. I'm a proud dad of my two daughters, cook sometimes, and am interested in a ton of weird stuff.</p>
   </aside>
  </section>
 </main>
</body>

</html>