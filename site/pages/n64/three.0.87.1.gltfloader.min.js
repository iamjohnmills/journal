THREE.GLTFLoader=function(){function e(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager}function a(){var e={};return{get:function(a){return e[a]},add:function(a,r){e[a]=r},remove:function(a){delete e[a]},removeAll:function(){e={}},update:function(a,r){for(var t in e){var n=e[t];n.update&&n.update(a,r)}}}}e.prototype={constructor:e,crossOrigin:"Anonymous",load:function(e,a,r,t){var n=this,s=this.path&&"string"==typeof this.path?this.path:THREE.Loader.prototype.extractUrlBase(e),i=new THREE.FileLoader(n.manager);i.setResponseType("arraybuffer"),i.load(e,(function(e){try{n.parse(e,s,a,t)}catch(e){t(e.constructor===Error?e:new Error("THREE.GLTFLoader: Unable to parse model."))}}),r,t)},setCrossOrigin:function(e){this.crossOrigin=e},setPath:function(e){this.path=e},parse:function(e,a,i,o){var c,p={};x(new Uint8Array(e,0,4))===s?(p[r.KHR_BINARY_GLTF]=new l(e),c=p[r.KHR_BINARY_GLTF].content):c=x(new Uint8Array(e));var d=JSON.parse(c);void 0===d.asset||d.asset.version[0]<2?o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")):(d.extensionsUsed&&(d.extensionsUsed.indexOf(r.KHR_LIGHTS)>=0&&(p[r.KHR_LIGHTS]=new t(d)),d.extensionsUsed.indexOf(r.KHR_MATERIALS_COMMON)>=0&&(p[r.KHR_MATERIALS_COMMON]=new n(d)),d.extensionsUsed.indexOf(r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS)>=0&&(p[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]=new u)),console.time("GLTFLoader"),new _(d,p,{path:a||this.path,crossOrigin:this.crossOrigin}).parse((function(e,a,r,t){console.timeEnd("GLTFLoader"),i({scene:e,scenes:a,cameras:r,animations:t})}),o))}};var r={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_LIGHTS:"KHR_lights",KHR_MATERIALS_COMMON:"KHR_materials_common",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness"};function t(e){this.name=r.KHR_LIGHTS,this.lights={};var a=(e.extensions&&e.extensions[r.KHR_LIGHTS]||{}).lights||{};for(var t in a){var n,s=a[t],i=(new THREE.Color).fromArray(s.color);switch(s.type){case"directional":(n=new THREE.DirectionalLight(i)).position.set(0,0,1);break;case"point":n=new THREE.PointLight(i);break;case"spot":(n=new THREE.SpotLight(i)).position.set(0,0,1);break;case"ambient":n=new THREE.AmbientLight(i)}n&&(void 0!==s.constantAttenuation&&(n.intensity=s.constantAttenuation),void 0!==s.linearAttenuation&&(n.distance=1/s.linearAttenuation),void 0!==s.quadraticAttenuation&&(n.decay=s.quadraticAttenuation),void 0!==s.fallOffAngle&&(n.angle=s.fallOffAngle),void 0!==s.fallOffExponent&&console.warn("THREE.GLTFLoader:: light.fallOffExponent not currently supported."),n.name=s.name||"light_"+t,this.lights[t]=n)}}function n(e){this.name=r.KHR_MATERIALS_COMMON}n.prototype.getMaterialType=function(e){switch(e.extensions[this.name].type){case"commonBlinn":case"commonPhong":return THREE.MeshPhongMaterial;case"commonLambert":return THREE.MeshLambertMaterial;default:return THREE.MeshBasicMaterial}},n.prototype.extendParams=function(e,a,r){var t=a.extensions[this.name],n=[],s=[];switch(t.type){case"commonBlinn":case"commonPhong":s.push("diffuseFactor","diffuseTexture","specularFactor","specularTexture","shininessFactor");break;case"commonLambert":s.push("diffuseFactor","diffuseTexture")}var i={};return s.forEach((function(e){void 0!==t[e]&&(i[e]=t[e])})),void 0!==i.diffuseFactor&&(e.color=(new THREE.Color).fromArray(i.diffuseFactor),e.opacity=i.diffuseFactor[3]),void 0!==i.diffuseTexture&&n.push(r.assignTexture(e,"map",i.diffuseTexture.index)),void 0!==i.specularFactor&&(e.specular=(new THREE.Color).fromArray(i.specularFactor)),void 0!==i.specularTexture&&n.push(r.assignTexture(e,"specularMap",i.specularTexture.index)),void 0!==i.shininessFactor&&(e.shininess=i.shininessFactor),Promise.all(n)};var s="glTF",i=12,o={JSON:1313821514,BIN:5130562};function l(e){this.name=r.KHR_BINARY_GLTF,this.content=null,this.body=null;var a=new DataView(e,0,i);if(this.header={magic:x(new Uint8Array(e.slice(0,4))),version:a.getUint32(4,!0),length:a.getUint32(8,!0)},this.header.magic!==s)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use GLTFLoader instead.");for(var t=new DataView(e,i),n=0;n<t.byteLength;){var l=t.getUint32(n,!0);n+=4;var u=t.getUint32(n,!0);if(n+=4,u===o.JSON){var c=new Uint8Array(e,i+n,l);this.content=x(c)}else if(u===o.BIN){var p=i+n;this.body=e.slice(p,p+l)}n+=l}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function u(){return{name:r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,getMaterialType:function(){return THREE.ShaderMaterial},extendParams:function(e,a,r){var t=a.extensions[this.name],n=THREE.ShaderLib.standard,s=THREE.UniformsUtils.clone(n.uniforms),i=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),o=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),u=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),c=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),p=n.fragmentShader.replace("#include <specularmap_fragment>","").replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",i).replace("#include <metalnessmap_pars_fragment>",o).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",u).replace("#include <lights_physical_fragment>",c);delete s.roughness,delete s.metalness,delete s.roughnessMap,delete s.metalnessMap,s.specular={value:(new THREE.Color).setHex(1118481)},s.glossiness={value:.5},s.specularMap={value:null},s.glossinessMap={value:null},e.vertexShader=n.vertexShader,e.fragmentShader=p,e.uniforms=s,e.defines={STANDARD:""},e.color=new THREE.Color(1,1,1),e.opacity=1;var d=[];if(Array.isArray(t.diffuseFactor)){var E=t.diffuseFactor;e.color.fromArray(E),e.opacity=E[3]}if(void 0!==t.diffuseTexture&&d.push(r.assignTexture(e,"map",t.diffuseTexture.index)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==t.glossinessFactor?t.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(t.specularFactor)&&e.specular.fromArray(t.specularFactor),void 0!==t.specularGlossinessTexture){var f=t.specularGlossinessTexture.index;d.push(r.assignTexture(e,"glossinessMap",f)),d.push(r.assignTexture(e,"specularMap",f))}return Promise.all(d)},createMaterial:function(e){var a=new THREE.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return a.isGLTFSpecularGlossinessMaterial=!0,a.color=e.color,a.map=void 0===e.map?null:e.map,a.lightMap=null,a.lightMapIntensity=1,a.aoMap=void 0===e.aoMap?null:e.aoMap,a.aoMapIntensity=1,a.emissive=e.emissive,a.emissiveIntensity=1,a.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,a.bumpMap=void 0===e.bumpMap?null:e.bumpMap,a.bumpScale=1,a.normalMap=void 0===e.normalMap?null:e.normalMap,a.normalScale=new THREE.Vector2(1,1),a.displacementMap=null,a.displacementScale=1,a.displacementBias=0,a.specularMap=void 0===e.specularMap?null:e.specularMap,a.specular=e.specular,a.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,a.glossiness=e.glossiness,a.alphaMap=null,a.envMap=void 0===e.envMap?null:e.envMap,a.envMapIntensity=1,a.refractionRatio=.98,a.extensions.derivatives=!0,a},refreshUniforms:function(e,a,r,t,n,s){var i,o=n.uniforms,l=n.defines;if(o.opacity.value=n.opacity,o.diffuse.value.copy(n.color),o.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),o.map.value=n.map,o.specularMap.value=n.specularMap,o.alphaMap.value=n.alphaMap,o.lightMap.value=n.lightMap,o.lightMapIntensity.value=n.lightMapIntensity,o.aoMap.value=n.aoMap,o.aoMapIntensity.value=n.aoMapIntensity,n.map?i=n.map:n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.glossinessMap?i=n.glossinessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap&&(i=n.emissiveMap),void 0!==i){i.isWebGLRenderTarget&&(i=i.texture);var u=i.offset,c=i.repeat;o.offsetRepeat.value.set(u.x,u.y,c.x,c.y)}o.envMap.value=n.envMap,o.envMapIntensity.value=n.envMapIntensity,o.flipEnvMap.value=n.envMap&&n.envMap.isCubeTexture?-1:1,o.refractionRatio.value=n.refractionRatio,o.specular.value.copy(n.specular),o.glossiness.value=n.glossiness,o.glossinessMap.value=n.glossinessMap,o.emissiveMap.value=n.emissiveMap,o.bumpMap.value=n.bumpMap,o.normalMap.value=n.normalMap,o.displacementMap.value=n.displacementMap,o.displacementScale.value=n.displacementScale,o.displacementBias.value=n.displacementBias,null!==o.glossinessMap.value&&void 0===l.USE_GLOSSINESSMAP&&(l.USE_GLOSSINESSMAP="",l.USE_ROUGHNESSMAP=""),null===o.glossinessMap.value&&void 0!==l.USE_GLOSSINESSMAP&&(delete l.USE_GLOSSINESSMAP,delete l.USE_ROUGHNESSMAP)}}}var c=0,p=1,d=2,E=3,f=4,m=5,h=6,v=(THREE.Matrix3,THREE.Matrix4,THREE.Vector2,THREE.Vector3,THREE.Vector4,THREE.Texture,{5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}),T={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},R={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},g={6406:THREE.AlphaFormat,6407:THREE.RGBFormat,6408:THREE.RGBAFormat,6409:THREE.LuminanceFormat,6410:THREE.LuminanceAlphaFormat},M={5121:THREE.UnsignedByteType,32819:THREE.UnsignedShort4444Type,32820:THREE.UnsignedShort5551Type,33635:THREE.UnsignedShort565Type},H=(THREE.BackSide,THREE.FrontSide,THREE.NeverDepth,THREE.LessDepth,THREE.EqualDepth,THREE.LessEqualDepth,THREE.GreaterEqualDepth,THREE.NotEqualDepth,THREE.GreaterEqualDepth,THREE.AlwaysDepth,THREE.AddEquation,THREE.SubtractEquation,THREE.ReverseSubtractEquation,THREE.ZeroFactor,THREE.OneFactor,THREE.SrcColorFactor,THREE.OneMinusSrcColorFactor,THREE.SrcAlphaFactor,THREE.OneMinusSrcAlphaFactor,THREE.DstAlphaFactor,THREE.OneMinusDstAlphaFactor,THREE.DstColorFactor,THREE.OneMinusDstColorFactor,THREE.SrcAlphaSaturateFactor,{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}),S={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},L={CATMULLROMSPLINE:THREE.InterpolateSmooth,CUBICSPLINE:THREE.InterpolateSmooth,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},y="OPAQUE";function A(e,a,r){if(!e)return Promise.resolve();var t,n=[];if("[object Array]"===Object.prototype.toString.call(e)){t=[];for(var s=e.length,i=0;i<s;i++){(l=a.call(r||this,e[i],i))&&(n.push(l),l instanceof Promise?l.then(function(e,a){t[e]=a}.bind(this,i)):t[i]=l)}}else for(var o in t={},e){var l;if(e.hasOwnProperty(o))(l=a.call(r||this,e[o],o))&&(n.push(l),l instanceof Promise?l.then(function(e,a){t[e]=a}.bind(this,o)):t[o]=l)}return Promise.all(n).then((function(){return t}))}function w(e,a){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:(a||"")+e}function x(e){if(void 0!==window.TextDecoder)return(new TextDecoder).decode(e);for(var a="",r=0,t=e.length;r<t;r++)a+=String.fromCharCode(e[r]);return a}function b(e,a,r,t){var n=e.geometry,s=e.material,i=r.targets,o=n.morphAttributes;o.position=[],o.normal=[],s.morphTargets=!0;for(var l=0,u=i.length;l<u;l++){var c,p,d=i[l],E="morphTarget"+l;if(void 0!==d.POSITION){c=t.accessors[d.POSITION].clone();for(var f=n.attributes.position,m=0,h=c.count;m<h;m++)c.setXYZ(m,c.getX(m)+f.getX(m),c.getY(m)+f.getY(m),c.getZ(m)+f.getZ(m))}else c=n.attributes.position.clone();if(void 0!==d.NORMAL){s.morphNormals=!0,p=t.accessors[d.NORMAL].clone();var v=n.attributes.normal;for(m=0,h=p.count;m<h;m++)p.setXYZ(m,p.getX(m)+v.getX(m),p.getY(m)+v.getY(m),p.getZ(m)+v.getZ(m))}else p=n.attributes.normal.clone();d.TANGENT,c.name=E,p.name=E,o.position.push(c),o.normal.push(p)}if(e.updateMorphTargets(),void 0!==a.weights)for(l=0,u=a.weights.length;l<u;l++)e.morphTargetInfluences[l]=a.weights[l]}function _(e,r,t){this.json=e||{},this.extensions=r||{},this.options=t||{},this.cache=new a}return _.prototype._withDependencies=function(e){for(var a={},r=0;r<e.length;r++){var t=e[r],n="load"+t.charAt(0).toUpperCase()+t.slice(1),s=this.cache.get(t);if(void 0!==s)a[t]=s;else if(this[n]){var i=this[n]();this.cache.add(t,i),a[t]=i}}return A(a,(function(e){return e}))},_.prototype.parse=function(e,a){var r=this.json;this.cache.removeAll(),this._withDependencies(["scenes","cameras","animations"]).then((function(a){var t=[];for(var n in a.scenes)t.push(a.scenes[n]);var s=void 0!==r.scene?a.scenes[r.scene]:t[0],i=[];for(var n in a.cameras){var o=a.cameras[n];i.push(o)}var l=[];for(var n in a.animations)l.push(a.animations[n]);e(s,t,i,l)})).catch(a)},_.prototype.getDependency=function(e,a){var r=e+":"+a,t=this.cache.get(r);t||(t=this["load"+e.charAt(0).toUpperCase()+e.slice(1)](a),this.cache.add(r,t));return t},_.prototype.loadBuffer=function(e){var a=this.json.buffers[e];if(a.type&&"arraybuffer"!==a.type)throw new Error("THREE.GLTFLoader: %s buffer type is not supported.",a.type);if(void 0===a.uri&&0===e)return Promise.resolve(this.extensions[r.KHR_BINARY_GLTF].body);var t=this.options;return new Promise((function(e){var r=new THREE.FileLoader;r.setResponseType("arraybuffer"),r.load(w(a.uri,t.path),e)}))},_.prototype.loadBufferView=function(e){var a=this.json.bufferViews[e];return this.getDependency("buffer",a.buffer).then((function(e){var r=a.byteLength||0,t=a.byteOffset||0;return e.slice(t,t+r)}))},_.prototype.loadAccessors=function(){var e=this,a=this.json;return A(a.accessors,(function(r){return e.getDependency("bufferView",r.bufferView).then((function(e){var t,n=H[r.type],s=v[r.componentType],i=s.BYTES_PER_ELEMENT,o=i*n,l=a.bufferViews[r.bufferView].byteStride;if(l&&l!==o){t=new s(e);var u=new THREE.InterleavedBuffer(t,l/i);return new THREE.InterleavedBufferAttribute(u,n,r.byteOffset/i)}return t=new s(e,r.byteOffset,r.count*n),new THREE.BufferAttribute(t,n)}))}))},_.prototype.loadTexture=function(e){var a=this.json,r=this.options,t=window.URL||window.webkitURL,n=a.textures[e],s=a.images[n.source],i=s.uri,o=!1;return void 0!==s.bufferView&&(i=this.getDependency("bufferView",s.bufferView).then((function(e){o=!0;var a=new Blob([e],{type:s.mimeType});return i=t.createObjectURL(a)}))),Promise.resolve(i).then((function(e){var a=THREE.Loader.Handlers.get(e)||new THREE.TextureLoader;return a.setCrossOrigin(r.crossOrigin),new Promise((function(t,n){a.load(w(e,r.path),t,void 0,n)}))})).then((function(e){void 0!==o&&t.revokeObjectURL(i),e.flipY=!1,void 0!==n.name&&(e.name=n.name),e.format=void 0!==n.format?g[n.format]:THREE.RGBAFormat,void 0!==n.internalFormat&&e.format!==g[n.internalFormat]&&console.warn("THREE.GLTFLoader: Three.js does not support texture internalFormat which is different from texture format. internalFormat will be forced to be the same value as format."),e.type=void 0!==n.type?M[n.type]:THREE.UnsignedByteType;var r=(a.samplers||{})[n.sampler]||{};return e.magFilter=T[r.magFilter]||THREE.LinearFilter,e.minFilter=T[r.minFilter]||THREE.LinearMipMapLinearFilter,e.wrapS=R[r.wrapS]||THREE.RepeatWrapping,e.wrapT=R[r.wrapT]||THREE.RepeatWrapping,e}))},_.prototype.assignTexture=function(e,a,r){return this.getDependency("texture",r).then((function(r){e[a]=r}))},_.prototype.loadMaterials=function(){var e=this,a=this.json,t=this.extensions;return A(a.materials,(function(a){var n,s={},i=a.extensions||{},o=[];if(i[r.KHR_MATERIALS_COMMON]){var l=t[r.KHR_MATERIALS_COMMON];n=l.getMaterialType(a),o.push(l.extendParams(s,a,e))}else if(i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=t[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];n=u.getMaterialType(a),o.push(u.extendParams(s,a,e))}else if(void 0!==a.pbrMetallicRoughness){n=THREE.MeshStandardMaterial;var c=a.pbrMetallicRoughness;if(s.color=new THREE.Color(1,1,1),s.opacity=1,Array.isArray(c.baseColorFactor)){var p=c.baseColorFactor;s.color.fromArray(p),s.opacity=p[3]}if(void 0!==c.baseColorTexture&&o.push(e.assignTexture(s,"map",c.baseColorTexture.index)),s.metalness=void 0!==c.metallicFactor?c.metallicFactor:1,s.roughness=void 0!==c.roughnessFactor?c.roughnessFactor:1,void 0!==c.metallicRoughnessTexture){var d=c.metallicRoughnessTexture.index;o.push(e.assignTexture(s,"metalnessMap",d)),o.push(e.assignTexture(s,"roughnessMap",d))}}else n=THREE.MeshPhongMaterial;!0===a.doubleSided&&(s.side=THREE.DoubleSide);var E=a.alphaMode||y;return s.transparent=E!==y,void 0!==a.normalTexture&&o.push(e.assignTexture(s,"normalMap",a.normalTexture.index)),void 0!==a.occlusionTexture&&o.push(e.assignTexture(s,"aoMap",a.occlusionTexture.index)),void 0!==a.emissiveFactor&&(n===THREE.MeshBasicMaterial?s.color=(new THREE.Color).fromArray(a.emissiveFactor):s.emissive=(new THREE.Color).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&(n===THREE.MeshBasicMaterial?o.push(e.assignTexture(s,"map",a.emissiveTexture.index)):o.push(e.assignTexture(s,"emissiveMap",a.emissiveTexture.index))),Promise.all(o).then((function(){var e;return e=n===THREE.ShaderMaterial?t[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(s):new n(s),void 0!==a.name&&(e.name=a.name),e.normalScale.x=-1,e.userData=a.extras,e}))}))},_.prototype.loadGeometries=function(e){return this._withDependencies(["accessors"]).then((function(a){return A(e,(function(e){var r=new THREE.BufferGeometry,t=e.attributes;for(var n in t){var s=t[n];if(void 0===s)return;var i=a.accessors[s];switch(n){case"POSITION":r.addAttribute("position",i);break;case"NORMAL":r.addAttribute("normal",i);break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":r.addAttribute("uv",i);break;case"TEXCOORD_1":r.addAttribute("uv2",i);break;case"COLOR_0":case"COLOR0":case"COLOR":r.addAttribute("color",i);break;case"WEIGHTS_0":case"WEIGHT":r.addAttribute("skinWeight",i);break;case"JOINTS_0":case"JOINT":r.addAttribute("skinIndex",i)}}return void 0!==e.indices&&r.setIndex(a.accessors[e.indices]),r}))}))},_.prototype.loadMeshes=function(){var e=this,a=this.json;return this._withDependencies(["accessors","materials"]).then((function(r){return A(a.meshes,(function(a){var t=new THREE.Group;void 0!==a.name&&(t.name=a.name),a.extras&&(t.userData=a.extras);var n=a.primitives||[];return e.loadGeometries(n).then((function(e){for(var s in n){var i,o=n[s],l=e[s],u=void 0===o.material?new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide}):r.materials[o.material];if(u.aoMap&&void 0===l.attributes.uv2&&void 0!==l.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),l.addAttribute("uv2",new THREE.BufferAttribute(l.attributes.uv.array,2))),void 0!==l.attributes.color&&(u.vertexColors=THREE.VertexColors,u.needsUpdate=!0),void 0===l.attributes.normal&&(void 0!==u.flatShading?u.flatShading=!0:u.shading=THREE.FlatShading),o.mode===f||void 0===o.mode)i=new THREE.Mesh(l,u);else if(o.mode===m)(i=new THREE.Mesh(l,u)).drawMode=THREE.TriangleStripDrawMode;else if(o.mode===h)(i=new THREE.Mesh(l,u)).drawMode=THREE.TriangleFanDrawMode;else if(o.mode===p)i=new THREE.LineSegments(l,u);else if(o.mode===E)i=new THREE.Line(l,u);else if(o.mode===d)i=new THREE.LineLoop(l,u);else{if(o.mode!==c)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: ",o.mode);i=new THREE.Points(l,u)}i.name=t.name+"_"+s,void 0!==o.targets&&b(i,a,o,r),o.extras&&(i.userData=o.extras),t.add(i)}return t}))}))}))},_.prototype.loadCameras=function(){return A(this.json.cameras,(function(e){var a,r=e[e.type];if(r){if("perspective"===e.type){var t=r.aspectRatio||1,n=r.yfov*t;a=new THREE.PerspectiveCamera(THREE.Math.radToDeg(n),t,r.znear||1,r.zfar||2e6)}else"orthographic"===e.type&&(a=new THREE.OrthographicCamera(r.xmag/-2,r.xmag/2,r.ymag/2,r.ymag/-2,r.znear,r.zfar));return void 0!==e.name&&(a.name=e.name),e.extras&&(a.userData=e.extras),a}console.warn("THREE.GLTFLoader: Missing camera parameters.")}))},_.prototype.loadSkins=function(){var e=this.json;return this._withDependencies(["accessors"]).then((function(a){return A(e.skins,(function(e){return{joints:e.joints,inverseBindMatrices:a.accessors[e.inverseBindMatrices]}}))}))},_.prototype.loadAnimations=function(){var e=this.json;return this._withDependencies(["accessors","nodes"]).then((function(a){return A(e.animations,(function(e,r){var t=[];for(var n in e.channels){var s=e.channels[n],i=e.samplers[s.sampler];if(i){var o=s.target,l=void 0!==o.node?o.node:o.id,u=void 0!==e.parameters?e.parameters[i.input]:i.input,c=void 0!==e.parameters?e.parameters[i.output]:i.output,p=a.accessors[u],d=a.accessors[c],E=a.nodes[l];if(E){var f;switch(E.updateMatrix(),E.matrixAutoUpdate=!0,S[o.path]){case S.weights:f=THREE.NumberKeyframeTrack;break;case S.rotation:f=THREE.QuaternionKeyframeTrack;break;default:f=THREE.VectorKeyframeTrack}var m=E.name?E.name:E.uuid;"CATMULLROMSPLINE"===i.interpolation&&console.warn("THREE.GLTFLoader: CATMULLROMSPLINE interpolation is not supported. Using CUBICSPLINE instead.");var h=void 0!==i.interpolation?L[i.interpolation]:THREE.InterpolateLinear,v=[];S[o.path]===S.weights?E.traverse((function(e){!0===e.isMesh&&!0===e.material.morphTargets&&v.push(e.name?e.name:e.uuid)})):v.push(m);for(var T=0,R=v.length;T<R;T++)t.push(new f(v[T]+"."+S[o.path],THREE.AnimationUtils.arraySlice(p.array,0),THREE.AnimationUtils.arraySlice(d.array,0),h))}}}l=void 0!==e.name?e.name:"animation_"+r;return new THREE.AnimationClip(l,void 0,t)}))}))},_.prototype.loadNodes=function(){var e=this.json,a=this.extensions,t=this,n=e.nodes||[];return(e.skins||[]).forEach((function(e){e.joints.forEach((function(e){n[e].isBone=!0}))})),A(e.nodes,(function(e){var a=new THREE.Matrix4,r=!0===e.isBone?new THREE.Bone:new THREE.Object3D;return void 0!==e.name&&(r.name=THREE.PropertyBinding.sanitizeNodeName(e.name)),e.extras&&(r.userData=e.extras),void 0!==e.matrix?(a.fromArray(e.matrix),r.applyMatrix(a)):(void 0!==e.translation&&r.position.fromArray(e.translation),void 0!==e.rotation&&r.quaternion.fromArray(e.rotation),void 0!==e.scale&&r.scale.fromArray(e.scale)),r})).then((function(n){return t._withDependencies(["meshes","skins","cameras"]).then((function(t){return A(n,(function(s,i){var o,l=e.nodes[i];if(void 0!==l.mesh?o=[l.mesh]:void 0!==l.meshes&&(console.warn("THREE.GLTFLoader: Legacy glTF file detected. Nodes may have no more than one mesh."),o=l.meshes),void 0!==o)for(var u in o){var c=o[u],p=t.meshes[c];if(void 0!==p){var d=p.clone(!1);for(var E in p.children){var f,m=p.children[E],h=m,v=m.material,T=m.geometry,R=m.morphTargetInfluences,g=m.userData,M=m.name,H=v;switch(m.type){case"LineSegments":m=new THREE.LineSegments(T,H);break;case"LineLoop":m=new THREE.LineLoop(T,H);break;case"Line":m=new THREE.Line(T,H);break;case"Points":m=new THREE.Points(T,H);break;default:(m=new THREE.Mesh(T,H)).drawMode=h.drawMode}if(m.castShadow=!0,m.morphTargetInfluences=R,m.userData=g,m.name=M,void 0!==l.skin&&(f=t.skins[l.skin]),f){var S=T;(H=v).skinning=!0,(m=new THREE.SkinnedMesh(S,H)).castShadow=!0,m.userData=g,m.name=M;for(var L=[],y=[],A=0,w=f.joints.length;A<w;A++){var x=f.joints[A],b=n[x];if(b){L.push(b);var _=f.inverseBindMatrices.array,F=(new THREE.Matrix4).fromArray(_,16*A);y.push(F)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',x)}m.bind(new THREE.Skeleton(L,y),m.matrixWorld)}d.add(m)}s.add(d)}else console.warn('THREE.GLTFLoader: Could not find node "'+c+'".')}if(void 0!==l.camera){var I=t.cameras[l.camera];s.add(I)}if(l.extensions&&l.extensions[r.KHR_LIGHTS]&&void 0!==l.extensions[r.KHR_LIGHTS].light){var O=a[r.KHR_LIGHTS].lights;s.add(O[l.extensions[r.KHR_LIGHTS].light])}return s}))}))}))},_.prototype.loadScenes=function(){var e=this.json,a=this.extensions;function t(a,r,n){var s=n[a];r.add(s);var i=e.nodes[a];if(i.children)for(var o=i.children,l=0,u=o.length;l<u;l++){t(o[l],s,n)}}return this._withDependencies(["nodes"]).then((function(n){return A(e.scenes,(function(e){var s=new THREE.Scene;void 0!==e.name&&(s.name=e.name),e.extras&&(s.userData=e.extras);for(var i=e.nodes||[],o=0,l=i.length;o<l;o++){t(i[o],s,n.nodes)}if(s.traverse((function(e){e.material&&e.material.isGLTFSpecularGlossinessMaterial&&(e.onBeforeRender=a[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms)})),e.extensions&&e.extensions[r.KHR_LIGHTS]&&void 0!==e.extensions[r.KHR_LIGHTS].light){var u=a[r.KHR_LIGHTS].lights;s.add(u[e.extensions[r.KHR_LIGHTS].light])}return s}))}))},e}();
